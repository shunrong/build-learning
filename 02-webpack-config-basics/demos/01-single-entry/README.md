# Demo 1: å•å…¥å£åº”ç”¨é…ç½®

## ğŸ“– è¯´æ˜

è¿™æ˜¯ä¸€ä¸ªå•é¡µåº”ç”¨ï¼ˆSPAï¼‰ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•é…ç½®å•å…¥å£ Webpack é¡¹ç›®ï¼Œå¹¶å¯¹æ¯”å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼çš„å·®å¼‚ã€‚

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- ç†è§£å•å…¥å£é…ç½®
- å¯¹æ¯”å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼
- ç†è§£ Source Map çš„ä½œç”¨
- ä½“éªŒçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰
- è§‚å¯Ÿä»£ç å‹ç¼©å’Œä¼˜åŒ–æ•ˆæœ

---

## ğŸš€ è¿è¡Œæ–¹å¼

### 1. å®‰è£…ä¾èµ–
```bash
npm install
```

### 2. å¼€å‘æ¨¡å¼ï¼ˆæ¨èä½“éªŒï¼‰
```bash
npm run dev
```

**æ•ˆæœ**ï¼š
- å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆhttp://localhost:8080ï¼‰
- è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
- æ”¯æŒçƒ­æ¨¡å—æ›¿æ¢ï¼ˆä¿®æ”¹ä»£ç è‡ªåŠ¨åˆ·æ–°ï¼‰
- å¿«é€Ÿæ„å»ºï¼Œå®Œæ•´ Source Map

### 3. ç”Ÿäº§æ¨¡å¼æ„å»º
```bash
npm run build
```

**æ•ˆæœ**ï¼š
- ä»£ç å‹ç¼©æ··æ·†
- æ–‡ä»¶åå¸¦ hashï¼š`bundle.[contenthash:8].js`
- ç”Ÿæˆ Source Map æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
- ä¼˜åŒ–ä½“ç§¯å’Œæ€§èƒ½

### 4. å¼€å‘æ¨¡å¼æ„å»ºï¼ˆå¯¹æ¯”ç”¨ï¼‰
```bash
npm run build:dev
```

**ç”¨é€”**ï¼š
- ç”Ÿæˆæœªå‹ç¼©çš„æ‰“åŒ…æ–‡ä»¶
- å¯¹æ¯”ç”Ÿäº§æ¨¡å¼çš„ä¼˜åŒ–æ•ˆæœ

### 5. æ‰“åŒ…åˆ†æ
```bash
npm run build:analyze
```

**æ•ˆæœ**ï¼š
- ç”Ÿæˆæ‰“åŒ…åˆ†ææŠ¥å‘Š
- å¯è§†åŒ–å±•ç¤ºæ–‡ä»¶å¤§å°å’Œä¾èµ–å…³ç³»

---

## ğŸ” ä½“éªŒè¦ç‚¹

### 1. å¯¹æ¯”æ„å»ºç»“æœ

#### å¼€å‘æ¨¡å¼
```bash
npm run build:dev
ls -lh dist/

# è¾“å‡ºç¤ºä¾‹ï¼š
# bundle.js          45KB  (æœªå‹ç¼©)
# bundle.js.map      89KB  (å®Œæ•´ Source Map)
```

#### ç”Ÿäº§æ¨¡å¼
```bash
npm run build
ls -lh dist/

# è¾“å‡ºç¤ºä¾‹ï¼š
# bundle.a1b2c3d4.js     12KB  (å‹ç¼©å)
# bundle.a1b2c3d4.js.map 35KB  (Source Map)
# runtime.e5f6g7h8.js    2KB   (runtime ä»£ç )
```

**å¯¹æ¯”**ï¼š
- æ–‡ä»¶å¤§å°ï¼š45KB â†’ 12KBï¼ˆå‡å°‘ 73%ï¼‰
- æ–‡ä»¶åï¼šå¸¦ hashï¼ˆåˆ©äºç¼“å­˜ï¼‰
- ä»£ç åˆ†å‰²ï¼šæå– runtime

---

### 2. è§‚å¯Ÿ Webpack é…ç½®

```javascript
// webpack.config.js
module.exports = (env, argv) => {
  const isDev = argv.mode === 'development';
  
  return {
    // ğŸ”¹ å¼€å‘æ¨¡å¼ï¼šbundle.js
    // ğŸ”¹ ç”Ÿäº§æ¨¡å¼ï¼šbundle.[contenthash:8].js
    output: {
      filename: isDev ? 'bundle.js' : 'bundle.[contenthash:8].js'
    },
    
    // ğŸ”¹ å¼€å‘æ¨¡å¼ï¼šå¿«é€Ÿ Source Map
    // ğŸ”¹ ç”Ÿäº§æ¨¡å¼ï¼šå®Œæ•´ Source Map
    devtool: isDev ? 'eval-cheap-module-source-map' : 'source-map',
    
    // ğŸ”¹ ç”Ÿäº§æ¨¡å¼ï¼šä»£ç å‹ç¼©ã€åˆ†å‰²
    optimization: {
      minimize: !isDev,
      runtimeChunk: isDev ? false : 'single',
      splitChunks: isDev ? false : { chunks: 'all' }
    }
  };
};
```

---

### 3. ä½“éªŒçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰

1. è¿è¡Œ `npm run dev`
2. æ‰“å¼€æµè§ˆå™¨ï¼ˆè‡ªåŠ¨æ‰“å¼€ï¼‰
3. ä¿®æ”¹ `src/utils.js` ä¸­çš„ä»£ç ï¼š
```javascript
export function log(message, type = 'info') {
  const timestamp = new Date().toLocaleTimeString();
  const logMessage = `[${timestamp}] ğŸ‰ ${message}`;  // æ·»åŠ  emoji
  // ...
}
```
4. ä¿å­˜æ–‡ä»¶
5. è§‚å¯Ÿæµè§ˆå™¨**è‡ªåŠ¨åˆ·æ–°**ï¼Œæ–°å†…å®¹ç«‹å³ç”Ÿæ•ˆ

**åŸç†**ï¼š
- webpack-dev-server ç›‘å¬æ–‡ä»¶å˜åŒ–
- é€šè¿‡ WebSocket æ¨é€æ›´æ–°
- æµè§ˆå™¨æ¥æ”¶æ›´æ–°ï¼Œå±€éƒ¨æ›¿æ¢æ¨¡å—
- **æ— éœ€æ‰‹åŠ¨åˆ·æ–°é¡µé¢**

---

### 4. æµ‹è¯• Source Map

1. è¿è¡Œ `npm run dev`
2. ç‚¹å‡»"è§¦å‘é”™è¯¯"æŒ‰é’®
3. æ‰“å¼€ Chrome DevTools
4. åˆ‡æ¢åˆ° **Sources** é¢æ¿
5. è§‚å¯Ÿé”™è¯¯å †æ ˆ

**å¼€å‘æ¨¡å¼**ï¼š
```
Error: è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯
    at triggerError (index.js:45)  âœ… æŒ‡å‘æºä»£ç 
```

**ç”Ÿäº§æ¨¡å¼ï¼ˆæ—  Source Mapï¼‰**ï¼š
```
Error: è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯
    at t.triggerError (bundle.a1b2c3d4.js:1)  âŒ æŒ‡å‘å‹ç¼©ä»£ç 
```

---

### 5. åŠ¨æ€å¯¼å…¥

ç‚¹å‡»"åŠ¨æ€åŠ è½½æ¨¡å—"æŒ‰é’®ï¼š

**å¼€å‘æ¨¡å¼**ï¼š
```
Network é¢æ¿ï¼š
- src_math_js.js  (åŠ¨æ€åŠ è½½çš„æ¨¡å—)
```

**ç”Ÿäº§æ¨¡å¼**ï¼š
```
Network é¢æ¿ï¼š
- src_math_js.a1b2c3d4.js  (å¸¦ hash çš„åŠ¨æ€æ¨¡å—)
```

**ä»£ç **ï¼š
```javascript
// åŠ¨æ€å¯¼å…¥
const { multiply } = await import('./math.js');
```

**æ•ˆæœ**ï¼š
- æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯
- ç‹¬ç«‹çš„ chunkï¼Œå¯ä»¥å•ç‹¬ç¼“å­˜

---

## ğŸ“Š é…ç½®è¯¦è§£

### Entryï¼ˆå…¥å£ï¼‰
```javascript
entry: './src/index.js'
```
- å•ä¸ªå…¥å£æ–‡ä»¶
- æœ€ç®€å•çš„é…ç½®
- é€‚åˆ SPAï¼ˆå•é¡µåº”ç”¨ï¼‰

### Outputï¼ˆè¾“å‡ºï¼‰
```javascript
output: {
  path: path.resolve(__dirname, 'dist'),         // è¾“å‡ºç›®å½•
  filename: isDev ? 'bundle.js' : 'bundle.[contenthash:8].js',
  clean: true                                     // æ¸…ç©ºæ—§æ–‡ä»¶
}
```

**æ–‡ä»¶åç­–ç•¥**ï¼š
- å¼€å‘æ¨¡å¼ï¼š`bundle.js`ï¼ˆç®€å•ï¼‰
- ç”Ÿäº§æ¨¡å¼ï¼š`bundle.[contenthash:8].js`ï¼ˆç¼“å­˜ï¼‰

### DevServerï¼ˆå¼€å‘æœåŠ¡å™¨ï¼‰
```javascript
devServer: {
  static: './dist',    // é™æ€æ–‡ä»¶ç›®å½•
  hot: true,           // çƒ­æ¨¡å—æ›¿æ¢
  port: 8080,          // ç«¯å£
  open: true,          // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  compress: true       // gzip å‹ç¼©
}
```

### Optimizationï¼ˆä¼˜åŒ–ï¼‰
```javascript
optimization: {
  minimize: !isDev,                    // æ˜¯å¦å‹ç¼©
  runtimeChunk: isDev ? false : 'single',  // æå– runtime
  splitChunks: isDev ? false : {       // ä»£ç åˆ†å‰²
    chunks: 'all'
  }
}
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆç”Ÿäº§æ¨¡å¼æ„å»ºæ—¶é—´æ›´é•¿ï¼Ÿ

**åŸå› **ï¼š
- ä»£ç å‹ç¼©ï¼ˆTerserï¼‰
- Tree Shaking
- Scope Hoisting
- Source Map ç”Ÿæˆ

**å¯¹æ¯”**ï¼š
```
å¼€å‘æ¨¡å¼: 2 ç§’
ç”Ÿäº§æ¨¡å¼: 8 ç§’
```

### Q2: ä»€ä¹ˆæ˜¯ contenthashï¼Ÿ

**contenthash**ï¼šæ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆçš„ hash

**ä½œç”¨**ï¼š
- å†…å®¹ä¸å˜ï¼Œhash ä¸å˜ â†’ æµè§ˆå™¨ä½¿ç”¨ç¼“å­˜
- å†…å®¹æ”¹å˜ï¼Œhash æ”¹å˜ â†’ æµè§ˆå™¨ä¸‹è½½æ–°æ–‡ä»¶

**ç¤ºä¾‹**ï¼š
```
ç¬¬ä¸€æ¬¡æ„å»º: bundle.a1b2c3d4.js
ä¿®æ”¹ä»£ç å: bundle.e5f6g7h8.js  (hash å˜äº†)
æœªä¿®æ”¹çš„æ–‡ä»¶: vendors.x9y0z1w2.js  (hash ä¸å˜)
```

### Q3: ä¸ºä»€ä¹ˆè¦æå– runtimeï¼Ÿ

**runtime**ï¼šWebpack çš„è¿è¡Œæ—¶ä»£ç ï¼Œç”¨äºåŠ è½½æ¨¡å—

**ä¸æå–**ï¼š
```
bundle.js  (ä¸šåŠ¡ä»£ç  + runtime)
```
- ä¸šåŠ¡ä»£ç å˜åŒ– â†’ bundle.js hash å˜åŒ–
- runtime ä¹Ÿè¢«é‡æ–°ä¸‹è½½

**æå–å**ï¼š
```
runtime.js  (åªæœ‰ runtime)
bundle.js   (åªæœ‰ä¸šåŠ¡ä»£ç )
```
- ä¸šåŠ¡ä»£ç å˜åŒ– â†’ åªæœ‰ bundle.js hash å˜åŒ–
- runtime.js hash ä¸å˜ï¼Œç»§ç»­ä½¿ç”¨ç¼“å­˜

---

## ğŸ¯ ç»ƒä¹ å»ºè®®

1. **ä¿®æ”¹é…ç½®å®éªŒ**ï¼š
   - æ”¹å˜è¾“å‡ºæ–‡ä»¶å
   - å°è¯•ä¸åŒçš„ Source Map ç±»å‹
   - è°ƒæ•´ä¼˜åŒ–é…ç½®

2. **å¯¹æ¯”æ•ˆæœ**ï¼š
   - è¿è¡Œ `npm run build:dev` å’Œ `npm run build`
   - å¯¹æ¯”æ–‡ä»¶å¤§å°å’Œå†…å®¹
   - ä½¿ç”¨ `npm run build:analyze` åˆ†ææ‰“åŒ…ç»“æœ

3. **ç†è§£ HMR**ï¼š
   - ä¿®æ”¹ä¸åŒçš„æ¨¡å—
   - è§‚å¯Ÿçƒ­æ›´æ–°æ•ˆæœ
   - ç†è§£ `module.hot.accept()` çš„ä½œç”¨

4. **æµ‹è¯• Source Map**ï¼š
   - è§¦å‘é”™è¯¯ï¼ŒæŸ¥çœ‹å †æ ˆ
   - å¯¹æ¯”æœ‰æ—  Source Map çš„å·®å¼‚
   - å°è¯•ä¸åŒçš„ devtool é…ç½®

---

## ğŸ“Š æ ¸å¿ƒè¦ç‚¹æ€»ç»“

### å•å…¥å£é…ç½®
- âœ… ä½¿ç”¨å­—ç¬¦ä¸²ï¼š`entry: './src/index.js'`
- âœ… é€‚åˆ SPAï¼ˆå•é¡µåº”ç”¨ï¼‰
- âœ… é…ç½®ç®€å•ï¼Œæ˜“äºç†è§£

### å¼€å‘ vs ç”Ÿäº§
| ç‰¹æ€§ | å¼€å‘æ¨¡å¼ | ç”Ÿäº§æ¨¡å¼ |
|------|---------|---------|
| **æ–‡ä»¶å** | `bundle.js` | `bundle.[hash].js` |
| **ä»£ç å‹ç¼©** | âŒ | âœ… |
| **Source Map** | å®Œæ•´ | å¯é€‰ |
| **HMR** | âœ… | âŒ |
| **æ„å»ºé€Ÿåº¦** | å¿« | æ…¢ |
| **æ–‡ä»¶å¤§å°** | å¤§ | å° |

### æœ€ä½³å®è·µ
1. å¼€å‘æ¨¡å¼é‡è§†é€Ÿåº¦å’Œè°ƒè¯•ä½“éªŒ
2. ç”Ÿäº§æ¨¡å¼é‡è§†ä½“ç§¯å’Œæ€§èƒ½
3. ä½¿ç”¨ contenthash å®ç°é•¿æœŸç¼“å­˜
4. æå– runtime å’Œå…¬å…±ä»£ç 

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å®Œæˆ Demo 1 åï¼Œç»§ç»­å­¦ä¹ ï¼š
- [Demo 2: å¤šå…¥å£åº”ç”¨](../02-multi-entry/) - å¤šé¡µåº”ç”¨é…ç½®
- [Demo 3: åŠ¨æ€å…¥å£](../03-dynamic-entry/) - è‡ªåŠ¨å‘ç°å…¥å£æ–‡ä»¶
- [Demo 4: è¾“å‡ºå‘½åç­–ç•¥](../04-output-patterns/) - Hash ç­–ç•¥è¯¦è§£

