# Demo 2: æœ€ç®€å•çš„ Webpack æ‰“åŒ…

## ğŸ“– è¯´æ˜

è¿™æ˜¯**åŒæ ·çš„è®¡ç®—å™¨åº”ç”¨**ï¼Œä½†ä½¿ç”¨äº† Webpack è¿›è¡Œæ‰“åŒ…ã€‚

é€šè¿‡å¯¹æ¯” [Demo 1](../01-no-bundler/)ï¼Œä½ å°†ç›´è§‚åœ°æ„Ÿå—åˆ° Webpack å¸¦æ¥çš„æ”¹å˜ã€‚

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- ç†è§£ Webpack çš„åŸºæœ¬é…ç½®
- ä½“éªŒæ¨¡å—åŒ–å¼€å‘çš„å¥½å¤„
- å¯¹æ¯”æ‰“åŒ…å‰åçš„å·®å¼‚
- ç†è§£ Webpack å¦‚ä½•è§£å†³ Demo 1 çš„é—®é¢˜

---

## ğŸš€ è¿è¡Œæ–¹å¼

### 1. å®‰è£…ä¾èµ–
```bash
npm install
```

### 2. å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰
```bash
npm start
```

è¿™ä¼šï¼š
- å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆhttp://localhost:8080ï¼‰
- è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
- æ”¯æŒçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰
- ä¿®æ”¹ä»£ç è‡ªåŠ¨åˆ·æ–°

### 3. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
# ç”Ÿäº§æ¨¡å¼æ„å»ºï¼ˆä»£ç ä¼šè¢«å‹ç¼©ï¼‰
npm run build

# å¼€å‘æ¨¡å¼æ„å»ºï¼ˆä»£ç ä¸å‹ç¼©ï¼Œæœ‰ source mapï¼‰
npm run build:dev

# æŸ¥çœ‹æ‰“åŒ…ç»“æœ
ls -lh dist/
```

---

## ğŸ” ä½“éªŒè¦ç‚¹

### 1. æŸ¥çœ‹é¡¹ç›®ç»“æ„

```
02-basic-bundle/
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ index.js           # å…¥å£æ–‡ä»¶ â­ï¸
â”‚   â”œâ”€â”€ calculator.js      # è®¡ç®—å™¨æ¨¡å—
â”‚   â”œâ”€â”€ validator.js       # éªŒè¯æ¨¡å—
â”‚   â”œâ”€â”€ ui.js              # UI æ¨¡å—
â”‚   â”œâ”€â”€ utils.js           # å·¥å…·æ¨¡å—
â”‚   â””â”€â”€ index.html         # HTML æ¨¡æ¿
â”œâ”€â”€ dist/                   # æ‰“åŒ…è¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ index.html         # è‡ªåŠ¨ç”Ÿæˆçš„ HTML
â”‚   â”œâ”€â”€ bundle.js          # æ‰“åŒ…åçš„ JS â­ï¸
â”‚   â””â”€â”€ bundle.js.map      # Source Map
â”œâ”€â”€ webpack.config.js      # Webpack é…ç½® â­ï¸
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®
â””â”€â”€ README.md              # æœ¬æ–‡ä»¶
```

---

### 2. å¯¹æ¯”æºä»£ç 

#### Demo 1ï¼ˆä¸ç”¨ Webpackï¼‰
```javascript
// å…¨å±€å˜é‡
var appName = "Calculator App";

// å…¨å±€å‡½æ•°
function log(message) {
  console.log(message);
}
```

#### Demo 2ï¼ˆä½¿ç”¨ Webpackï¼‰
```javascript
// âœ… ES Modules - å¯¼å‡º
export const appName = "Calculator App";

export function log(message) {
  console.log(message);
}

// âœ… ES Modules - å¯¼å…¥
import { log } from './utils.js';
```

**åŒºåˆ«**ï¼š
- âœ… ä½¿ç”¨ `import/export` è¯­æ³•
- âœ… ä¾èµ–å…³ç³»æ¸…æ™°å¯è§
- âœ… æ²¡æœ‰å…¨å±€å˜é‡æ±¡æŸ“

---

### 3. æ‰“å¼€ Network é¢æ¿

#### Demo 1ï¼ˆä¸ç”¨ Webpackï¼‰
```
index.html       200  1.2KB
utils.js         200  1.5KB
validator.js     200  2.1KB
calculator.js    200  1.8KB
ui.js            200  2.3KB
app.js           200  1.9KB
æ€»è®¡ï¼š6 ä¸ªè¯·æ±‚ï¼Œ10.8KB
```

#### Demo 2ï¼ˆä½¿ç”¨ Webpackï¼‰
```
index.html       200  2.5KB
bundle.js        200  8.2KB
æ€»è®¡ï¼š2 ä¸ªè¯·æ±‚ï¼Œ10.7KB

# ç”Ÿäº§æ¨¡å¼æ„å»ºå
bundle.js        200  3.1KBï¼ˆå‹ç¼©åï¼‰
```

**åŒºåˆ«**ï¼š
- âœ… **6 ä¸ªæ–‡ä»¶ â†’ 1 ä¸ªæ–‡ä»¶**
- âœ… **6 ä¸ªè¯·æ±‚ â†’ 1 ä¸ªè¯·æ±‚**
- âœ… **ç”Ÿäº§æ¨¡å¼ä¸‹ä»£ç è‡ªåŠ¨å‹ç¼©**

---

### 4. æŸ¥çœ‹æ‰“åŒ…åçš„ä»£ç 

```bash
# å¼€å‘æ¨¡å¼ï¼ˆå¯è¯»ï¼‰
npm run build:dev
cat dist/bundle.js

# ç”Ÿäº§æ¨¡å¼ï¼ˆå‹ç¼©ï¼‰
npm run build
cat dist/bundle.js
```

**ä½ ä¼šçœ‹åˆ°**ï¼š
- æ‰€æœ‰æ¨¡å—éƒ½è¢«åŒ…è£¹åœ¨ä¸€ä¸ª IIFE ä¸­
- Webpack çš„è¿è¡Œæ—¶ä»£ç ï¼ˆ`__webpack_require__`ï¼‰
- æ¨¡å—æ˜ å°„å¯¹è±¡
- ç”Ÿäº§æ¨¡å¼ä¸‹ä»£ç è¢«å‹ç¼©æ··æ·†

---

### 5. åœ¨ Console ä¸­æµ‹è¯•

```javascript
// Demo 1ï¼ˆä¸ç”¨ Webpackï¼‰
console.log(window.appName);     // âœ… "Calculator App" - å…¨å±€å˜é‡
console.log(window.Calculator);  // âœ… {add: Æ’, ...} - å…¨å±€å¯¹è±¡
window.Calculator = null;        // âš ï¸ å¯ä»¥è¢«éšæ„ä¿®æ”¹ï¼

// Demo 2ï¼ˆä½¿ç”¨ Webpackï¼‰
console.log(window.appName);     // âŒ undefined - ä¸åœ¨å…¨å±€ï¼
console.log(window.Calculator);  // âŒ undefined - ä¸åœ¨å…¨å±€ï¼

// âœ… æ‰€æœ‰å˜é‡éƒ½åœ¨æ¨¡å—ä½œç”¨åŸŸå†…ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®å’Œä¿®æ”¹
```

---

### 6. ç†è§£ Webpack é…ç½®

```javascript
// webpack.config.js
module.exports = {
  // 1ï¸âƒ£ å…¥å£ï¼šå‘Šè¯‰ Webpack ä»å“ªé‡Œå¼€å§‹
  entry: './src/index.js',
  
  // 2ï¸âƒ£ è¾“å‡ºï¼šå‘Šè¯‰ Webpack æ‰“åŒ…åˆ°å“ªé‡Œ
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.js'
  },
  
  // 3ï¸âƒ£ æ’ä»¶ï¼šæ‰©å±• Webpack åŠŸèƒ½
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html'  // è‡ªåŠ¨ç”Ÿæˆ HTML
    })
  ]
};
```

**è¿™å°±æ˜¯æœ€åŸºç¡€çš„ Webpack é…ç½®ï¼**

---

### 7. ä½“éªŒçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰

1. è¿è¡Œ `npm start`
2. ä¿®æ”¹ `src/utils.js` ä¸­çš„ä»£ç ï¼š
```javascript
export const appName = "æˆ‘çš„è®¡ç®—å™¨";  // æ”¹ä¸ªä¸­æ–‡å
```
3. ä¿å­˜æ–‡ä»¶
4. æµè§ˆå™¨**è‡ªåŠ¨åˆ·æ–°**ï¼Œæ˜¾ç¤ºæ–°çš„åº”ç”¨å

**è¿™å°±æ˜¯ Webpack çš„å¼€å‘ä½“éªŒï¼**

---

## ğŸ“Š Demo 1 vs Demo 2 å¯¹æ¯”

| ç‰¹æ€§ | Demo 1ï¼ˆæ— æ‰“åŒ…ï¼‰ | Demo 2ï¼ˆWebpackï¼‰ |
|------|-----------------|------------------|
| **æ¨¡å—ç³»ç»Ÿ** | âŒ å…¨å±€å˜é‡ | âœ… ES Modules |
| **ä¾èµ–ç®¡ç†** | âŒ æ‰‹åŠ¨æ’åº script | âœ… è‡ªåŠ¨åˆ†æ |
| **HTTP è¯·æ±‚** | âŒ 6 ä¸ªæ–‡ä»¶ | âœ… 1 ä¸ªæ–‡ä»¶ |
| **å…¨å±€æ±¡æŸ“** | âŒ ä¸¥é‡ | âœ… æ— æ±¡æŸ“ |
| **ä»£ç å‹ç¼©** | âŒ æ—  | âœ… è‡ªåŠ¨å‹ç¼© |
| **å¼€å‘ä½“éªŒ** | âŒ æ‰‹åŠ¨åˆ·æ–° | âœ… HMR |
| **npm åŒ…** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **ç°ä»£è¯­æ³•** | âŒ å—é™ | âœ… ES6+ |

---

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### 1. Entryï¼ˆå…¥å£ï¼‰
```javascript
entry: './src/index.js'
```
- Webpack ä»è¿™é‡Œå¼€å§‹åˆ†æä¾èµ–
- å¯ä»¥æœ‰å¤šä¸ªå…¥å£ï¼ˆå¤šé¡µåº”ç”¨ï¼‰

### 2. Outputï¼ˆè¾“å‡ºï¼‰
```javascript
output: {
  path: path.resolve(__dirname, 'dist'),
  filename: 'bundle.js'
}
```
- æŒ‡å®šæ‰“åŒ…åçš„æ–‡ä»¶è¾“å‡ºåˆ°å“ªé‡Œ
- å¯ä»¥è‡ªå®šä¹‰æ–‡ä»¶åï¼ˆæ”¯æŒ hashï¼‰

### 3. Pluginï¼ˆæ’ä»¶ï¼‰
```javascript
plugins: [
  new HtmlWebpackPlugin({
    template: './src/index.html'
  })
]
```
- æ‰©å±• Webpack åŠŸèƒ½
- è¿™é‡Œä½¿ç”¨äº† `HtmlWebpackPlugin`ï¼š
  - è‡ªåŠ¨ç”Ÿæˆ HTML
  - è‡ªåŠ¨æ³¨å…¥æ‰“åŒ…åçš„ JS
  - è‡ªåŠ¨å¤„ç†è·¯å¾„

### 4. Modeï¼ˆæ¨¡å¼ï¼‰
```bash
# å¼€å‘æ¨¡å¼
webpack --mode development
- ä¸å‹ç¼©ä»£ç 
- ç”Ÿæˆ Source Map
- å¯ç”¨å¼€å‘å·¥å…·

# ç”Ÿäº§æ¨¡å¼
webpack --mode production
- å‹ç¼©ä»£ç 
- ç§»é™¤æ³¨é‡Š
- ä¼˜åŒ–æ€§èƒ½
```

---

## ğŸ’¡ æ·±å…¥ç†è§£

### Webpack åšäº†ä»€ä¹ˆï¼Ÿ

1. **åˆ†æä¾èµ–**ï¼š
```
index.js
  â”œâ”€â”€ utils.js
  â”œâ”€â”€ calculator.js
  â”œâ”€â”€ validator.js
  â”‚   â””â”€â”€ utils.js
  â””â”€â”€ ui.js
      â”œâ”€â”€ utils.js
      â”œâ”€â”€ validator.js
      â””â”€â”€ calculator.js
```

2. **æ„å»ºä¾èµ–å›¾**ï¼š
- é€’å½’åˆ†ææ‰€æœ‰ `import` è¯­å¥
- æ‰¾å‡ºæ‰€æœ‰ä¾èµ–çš„æ¨¡å—
- æ„å»ºå®Œæ•´çš„ä¾èµ–å…³ç³»å›¾

3. **æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶**ï¼š
```javascript
(function(modules) {
  // Webpack è¿è¡Œæ—¶
  function __webpack_require__(moduleId) {
    // åŠ è½½æ¨¡å—
  }
  
  // æ¨¡å—æ˜ å°„
  var moduleMap = {
    './src/index.js': function() { /* ... */ },
    './src/utils.js': function() { /* ... */ },
    // ...
  };
  
  // å¯åŠ¨åº”ç”¨
  __webpack_require__('./src/index.js');
})();
```

4. **ç”Ÿæˆ HTML**ï¼š
```html
<!DOCTYPE html>
<html>
<head>...</head>
<body>
  ...
  <script src="bundle.js"></script>  <!-- è‡ªåŠ¨æ³¨å…¥ -->
</body>
</html>
```

---

## ğŸ¯ æ€è€ƒé¢˜

1. **æ¨¡å—åŒ–**ï¼š
   - ES Modules å’Œå…¨å±€å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
   - ä¸ºä»€ä¹ˆ import/export æ›´å¥½ï¼Ÿ

2. **ä¾èµ–ç®¡ç†**ï¼š
   - Webpack å¦‚ä½•çŸ¥é“ä¸€ä¸ªæ¨¡å—ä¾èµ–äº†å“ªäº›å…¶ä»–æ¨¡å—ï¼Ÿ
   - ä¸ºä»€ä¹ˆä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†åŠ è½½é¡ºåºäº†ï¼Ÿ

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - ä¸ºä»€ä¹ˆæ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶æ›´å¿«ï¼Ÿ
   - å¤šä¸ªå°æ–‡ä»¶ vs ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå“ªä¸ªæ›´å¥½ï¼Ÿ

4. **å¼€å‘ä½“éªŒ**ï¼š
   - HMRï¼ˆçƒ­æ¨¡å—æ›¿æ¢ï¼‰æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
   - ä¸ºä»€ä¹ˆä¿®æ”¹ä»£ç åæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ·æ–°ï¼Ÿ

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å®Œæˆäº† Phase 1.1 çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»ï¼š
- âœ… ç†è§£äº†ä¸ºä»€ä¹ˆéœ€è¦æ‰“åŒ…å·¥å…·
- âœ… ä½“éªŒäº† Webpack çš„åŸºæœ¬åŠŸèƒ½
- âœ… ç†è§£äº†æ¨¡å—åŒ–çš„ä»·å€¼
- âœ… èƒ½å¤Ÿé…ç½®æœ€ç®€å•çš„ Webpack é¡¹ç›®

**æ¥ä¸‹æ¥**ï¼š
- **Phase 1.2**ï¼šé…ç½®ç³»ç»Ÿå…¥é—¨ - æ·±å…¥å­¦ä¹  entry/output/mode é…ç½®
- **Phase 1.3**ï¼šLoader æœºåˆ¶ - å¤„ç† CSSã€å›¾ç‰‡ç­‰é JS æ–‡ä»¶
- **Phase 1.4**ï¼šPlugin æœºåˆ¶ - æ·±å…¥ç†è§£æ’ä»¶ç³»ç»Ÿ

---

## ğŸ“ ç»ƒä¹ å»ºè®®

1. **ä¿®æ”¹é…ç½®**ï¼š
   - æ”¹å˜è¾“å‡ºæ–‡ä»¶åï¼š`bundle.js` â†’ `app.js`
   - æ”¹å˜è¾“å‡ºç›®å½•ï¼š`dist` â†’ `build`
   - æ·»åŠ  hashï¼š`bundle.[contenthash].js`

2. **æ·»åŠ æ–°æ¨¡å—**ï¼š
   - åˆ›å»º `src/history.js`ï¼Œè®°å½•è®¡ç®—å†å²
   - åœ¨ `index.js` ä¸­å¯¼å…¥å¹¶ä½¿ç”¨
   - è§‚å¯Ÿ Webpack å¦‚ä½•å¤„ç†æ–°æ¨¡å—

3. **å¯¹æ¯”æ‰“åŒ…ç»“æœ**ï¼š
   - è¿è¡Œ `npm run build:dev` å’Œ `npm run build`
   - å¯¹æ¯”ä¸¤ä¸ª `bundle.js` çš„åŒºåˆ«
   - ç†è§£å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼çš„å·®å¼‚

---

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™ä¸ª Demoï¼Œä½ åº”è¯¥æ·±åˆ»ç†è§£äº†ï¼š

1. **Webpack çš„æ ¸å¿ƒä»·å€¼**ï¼š
   - æ¨¡å—åŒ–ç®¡ç†
   - ä¾èµ–è‡ªåŠ¨åˆ†æ
   - æ‰“åŒ…ä¼˜åŒ–

2. **æ¨¡å—åŒ–çš„å¥½å¤„**ï¼š
   - æ— å…¨å±€æ±¡æŸ“
   - ä¾èµ–å…³ç³»æ¸…æ™°
   - ä»£ç æ˜“äºç»´æŠ¤

3. **å¼€å‘ä½“éªŒçš„æå‡**ï¼š
   - HMR çƒ­æ›´æ–°
   - è‡ªåŠ¨åˆ·æ–°
   - å¼€å‘æœåŠ¡å™¨

**è¿™å°±æ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„åŸºç¡€ï¼** ğŸš€

