# Demo 01: æ„å»ºåˆ†æå·¥å…·

## ğŸ“– å­¦ä¹ ç›®æ ‡

æŒæ¡ä½¿ç”¨åˆ†æå·¥å…·å®šä½ Webpack æ„å»ºæ€§èƒ½ç“¶é¢ˆçš„æ–¹æ³•ã€‚

---

## ğŸ› ï¸ ä½¿ç”¨çš„å·¥å…·

### 1. speed-measure-webpack-plugin â­ï¸â­ï¸â­ï¸

**ä½œç”¨**ï¼šæµ‹é‡æ¯ä¸ª Loader å’Œ Plugin çš„è€—æ—¶ã€‚

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
SMP  â±  General output time took 5.234 secs

SMP  â±  Loaders
babel-loader took 3.456 secs
  module count = 15
css-loader, and style-loader took 1.234 secs
  module count = 2
```

---

### 2. webpack-bundle-analyzer â­ï¸â­ï¸â­ï¸

**ä½œç”¨**ï¼šå¯è§†åŒ–åˆ†ææ‰“åŒ…ä½“ç§¯ã€‚

**åŠŸèƒ½**ï¼š
- æŸ¥çœ‹æ¯ä¸ªæ¨¡å—çš„ä½“ç§¯
- è¯†åˆ«é‡å¤æ‰“åŒ…
- æ‰¾å‡ºä½“ç§¯å¤§æˆ·

---

### 3. webpack --profile --json

**ä½œç”¨**ï¼šç”Ÿæˆå®Œæ•´çš„æ„å»ºç»Ÿè®¡ä¿¡æ¯ã€‚

**ç”¨é€”**ï¼š
- æ·±åº¦åˆ†ææ„å»ºè¿‡ç¨‹
- ä¸Šä¼ åˆ°åœ¨çº¿å·¥å…·åˆ†æ

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å®‰è£…ä¾èµ–

```bash
npm install
```

---

### æ–¹å¼ 1ï¼šæµ‹é‡æ„å»ºè€—æ—¶

```bash
npm run build:measure
```

**æŸ¥çœ‹ç»“æœ**ï¼š
- æ‰“å¼€ `build-measure.txt` æ–‡ä»¶
- æŸ¥çœ‹æ¯ä¸ª Loader/Plugin çš„è€—æ—¶
- æ‰¾å‡ºæœ€æ…¢çš„ç¯èŠ‚

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
SMP  â±  General output time took 5.234 secs

SMP  â±  Loaders
babel-loader took 3.456 secs (66%)  â† âš ï¸ ä¸»è¦ç“¶é¢ˆ
  module count = 15
  
css-loader, and style-loader took 1.234 secs (24%)
  module count = 2

SMP  â±  Plugins
HtmlWebpackPlugin took 0.456 secs (9%)
```

---

### æ–¹å¼ 2ï¼šåˆ†ææ‰“åŒ…ä½“ç§¯

#### Step 1: ç”Ÿæˆåˆ†ææ•°æ®

```bash
npm run build:analyze
```

è¿™ä¼šç”Ÿæˆ `stats.json` æ–‡ä»¶ã€‚

#### Step 2: æŸ¥çœ‹å¯è§†åŒ–æŠ¥å‘Š

```bash
npm run analyze
```

æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ï¼Œæ˜¾ç¤ºå¯è§†åŒ–çš„ä½“ç§¯åˆ†ææŠ¥å‘Šã€‚

**ä½ ä¼šçœ‹åˆ°**ï¼š
- ğŸ“Š äº¤äº’å¼çš„æ ‘çŠ¶å›¾
- ğŸ“¦ æ¯ä¸ªæ¨¡å—çš„ä½“ç§¯
- ğŸ” å¯ä»¥æ”¾å¤§ç¼©å°æŸ¥çœ‹ç»†èŠ‚

---

### æ–¹å¼ 3ï¼šæ™®é€šæ„å»º

```bash
npm run build
```

ç”Ÿæˆç”Ÿäº§ç¯å¢ƒçš„æ‰“åŒ…æ–‡ä»¶ã€‚

---

## ğŸ“Š åˆ†æè¦ç‚¹

### 1. ä» build-measure.txt åˆ†æè€—æ—¶

**æŸ¥çœ‹è¦ç‚¹**ï¼š

```
é—®é¢˜ 1ï¼šå“ªä¸ª Loader æœ€æ…¢ï¼Ÿ
  â””â”€ å¦‚æœæ˜¯ babel-loader â†’ è€ƒè™‘ç¼“å­˜ä¼˜åŒ–

é—®é¢˜ 2ï¼šå¤„ç†äº†å¤šå°‘æ¨¡å—ï¼Ÿ
  â””â”€ module count è¿‡å¤š â†’ è€ƒè™‘å‡å°‘æ„å»ºèŒƒå›´

é—®é¢˜ 3ï¼šè€—æ—¶å æ¯”å¤šå°‘ï¼Ÿ
  â””â”€ å æ¯” > 50% â†’ ä¼˜å…ˆä¼˜åŒ–è¿™ä¸ªç¯èŠ‚
```

---

### 2. ä» bundle-report åˆ†æä½“ç§¯

**æŸ¥çœ‹è¦ç‚¹**ï¼š

```
é—®é¢˜ 1ï¼šå“ªä¸ªä¾èµ–æœ€å¤§ï¼Ÿ
  â””â”€ å¯èƒ½çš„ä¼˜åŒ–ï¼šExternalsã€æŒ‰éœ€å¼•å…¥

é—®é¢˜ 2ï¼šæ˜¯å¦æœ‰é‡å¤æ‰“åŒ…ï¼Ÿ
  â””â”€ åŒä¸€ä¸ªåº“è¢«æ‰“åŒ…å¤šæ¬¡

é—®é¢˜ 3ï¼šæ˜¯å¦æœ‰ä¸éœ€è¦çš„ä»£ç ï¼Ÿ
  â””â”€ å¦‚ moment.js çš„ locale æ–‡ä»¶
```

---

## ğŸ¯ å®æˆ˜ç»ƒä¹ 

### ç»ƒä¹  1ï¼šæ‰¾å‡ºæœ€æ…¢çš„ Loader

1. è¿è¡Œ `npm run build:measure`
2. æŸ¥çœ‹ `build-measure.txt`
3. å›ç­”ï¼š
   - å“ªä¸ª Loader æœ€è€—æ—¶ï¼Ÿ
   - å æ€»æ—¶é—´çš„ç™¾åˆ†æ¯”ï¼Ÿ
   - å¤„ç†äº†å¤šå°‘ä¸ªæ¨¡å—ï¼Ÿ

---

### ç»ƒä¹  2ï¼šåˆ†æåŒ…ä½“ç§¯

1. è¿è¡Œ `npm run build:analyze`
2. è¿è¡Œ `npm run analyze`
3. å›ç­”ï¼š
   - æœ€å¤§çš„ä¾èµ–æ˜¯ä»€ä¹ˆï¼Ÿ
   - React å’Œ React-DOM å å¤šå¤§ï¼Ÿ
   - ä½ çš„ä¸šåŠ¡ä»£ç å å¤šå¤§ï¼Ÿ

---

### ç»ƒä¹  3ï¼šå¯¹æ¯”ä¼˜åŒ–æ•ˆæœ

**åœºæ™¯**ï¼šå‡è®¾ä½ è¦æ·»åŠ  `lodash` ä¾èµ–

```bash
# 1. å…ˆè®°å½•å½“å‰ä½“ç§¯
npm run build:analyze
# è®°å½•æ€»ä½“ç§¯

# 2. å®‰è£… lodash
npm install lodash

# 3. åœ¨ App.js ä¸­ä½¿ç”¨
import _ from 'lodash';
// ...ä½¿ç”¨ lodash

# 4. å†æ¬¡åˆ†æ
npm run build:analyze
npm run analyze

# 5. å¯¹æ¯”ä½“ç§¯å˜åŒ–
```

**æ€è€ƒ**ï¼š
- ä½“ç§¯å¢åŠ äº†å¤šå°‘ï¼Ÿ
- lodash å äº†å¤šå¤§ï¼Ÿ
- å¦‚ä½•ä¼˜åŒ–ï¼Ÿï¼ˆæç¤ºï¼šlodash-es + Tree Shakingï¼‰

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

åŸºäºåˆ†æç»“æœï¼Œå¯èƒ½çš„ä¼˜åŒ–æ–¹å‘ï¼š

### å¦‚æœ babel-loader æ…¢ï¼š
```javascript
// webpack.config.js
{
  loader: 'babel-loader',
  options: {
    cacheDirectory: true  // â­ï¸ å¯ç”¨ç¼“å­˜
  }
}
```

### å¦‚æœåŒ…ä½“ç§¯å¤§ï¼š
```javascript
// webpack.config.js
externals: {
  'react': 'React',
  'react-dom': 'ReactDOM'
}
```

### å¦‚æœæœ‰é‡å¤æ¨¡å—ï¼š
```javascript
// webpack.config.js
optimization: {
  splitChunks: {
    chunks: 'all'
  }
}
```

---

## ğŸ“ åˆ†ææŠ¥å‘Šæ¨¡æ¿

å°†ä½ çš„åˆ†æç»“æœå¡«å…¥ä»¥ä¸‹æ¨¡æ¿ï¼š

```markdown
## æ„å»ºåˆ†ææŠ¥å‘Š

### æ„å»ºè€—æ—¶åˆ†æ

**æ€»æ„å»ºæ—¶é—´**ï¼š___ ç§’

**Loader è€—æ—¶æ’å**ï¼š
1. babel-loader: ___ ç§’ï¼ˆ____%ï¼‰
2. css-loader: ___ ç§’ï¼ˆ____%ï¼‰
3. ...

**ä¼˜åŒ–å»ºè®®**ï¼š
- [ ] ...

---

### åŒ…ä½“ç§¯åˆ†æ

**æ€»ä½“ç§¯ï¼ˆæœªå‹ç¼©ï¼‰**ï¼š___ MB

**ä½“ç§¯æ’å**ï¼š
1. react: ___ KB
2. react-dom: ___ KB
3. ...

**ä¼˜åŒ–å»ºè®®**ï¼š
- [ ] ...
```

---

## ğŸ“ å…³é”®çŸ¥è¯†ç‚¹

### 1. ä¸ºä»€ä¹ˆè¦å…ˆåˆ†æï¼Ÿ

âŒ **é”™è¯¯**ï¼šç›²ç›®ä¼˜åŒ–
```
çœ‹åˆ°æ–‡ç« è¯´è¦ç”¨ thread-loader
â†’ ç›´æ¥åŠ ä¸Š
â†’ åè€Œå˜æ…¢äº†ï¼ˆå°é¡¹ç›®ï¼ŒWorker å¼€é”€å¤§ï¼‰
```

âœ… **æ­£ç¡®**ï¼šåˆ†æåä¼˜åŒ–
```
åˆ†æå‘ç°ï¼šbabel-loader å  70% æ—¶é—´
â†’ é’ˆå¯¹æ€§ä¼˜åŒ–ï¼šå¯ç”¨ç¼“å­˜
â†’ æ•ˆæœï¼šæ„å»ºæ—¶é—´å‡å°‘ 50%
```

---

### 2. åˆ†æå·¥å…·çš„é€‰æ‹©

| å·¥å…· | åˆ†æå†…å®¹ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|
| speed-measure | æ„å»ºè€—æ—¶ | ä¼˜åŒ–æ„å»ºé€Ÿåº¦ |
| bundle-analyzer | åŒ…ä½“ç§¯ | ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ |
| webpack --profile | å®Œæ•´ç»Ÿè®¡ | æ·±åº¦åˆ†æ |

**å»ºè®®**ï¼š
- ğŸš€ é¦–æ¬¡ä¼˜åŒ–ï¼šspeed-measure + bundle-analyzer
- ğŸ” æ·±åº¦åˆ†æï¼šwebpack --profile --json

---

### 3. ä¼˜åŒ–çš„ä¼˜å…ˆçº§

```
ä¼˜å…ˆçº§æ’åºï¼š
1. æ•ˆæœæœ€å¥½çš„ï¼ˆå¦‚ç¼“å­˜ -90%ï¼‰
2. æˆæœ¬æœ€ä½çš„ï¼ˆé…ç½®ç®€å•ï¼‰
3. é£é™©æœ€å°çš„ï¼ˆä¸ä¼šå¼•å…¥æ–°é—®é¢˜ï¼‰

æœ¬ Demo çš„åˆ†æå°±æ˜¯å¸®ä½ ç¡®å®šä¼˜å…ˆçº§ï¼
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

åˆ†æå®Œæˆåï¼Œè¿›å…¥ä¸‹ä¸€ä¸ª Demoï¼š
- **Demo 02: ç¼“å­˜ä¼˜åŒ–** - ä½“éªŒç¼“å­˜å¸¦æ¥çš„å·¨å¤§æå‡

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [01-build-analysis.md](../../docs/01-build-analysis.md) - æ„å»ºåˆ†æè¯¦ç»†æ–‡æ¡£
- [speed-measure-webpack-plugin](https://github.com/stephencookdev/speed-measure-webpack-plugin)
- [webpack-bundle-analyzer](https://github.com/webpack-contrib/webpack-bundle-analyzer)

