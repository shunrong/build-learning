# Demo 02: ç¼“å­˜ä¼˜åŒ–

## ğŸ“– å­¦ä¹ ç›®æ ‡

ä½“éªŒç¼“å­˜ä¼˜åŒ–å¸¦æ¥çš„**å·¨å¤§æ€§èƒ½æå‡**ï¼ˆäºŒæ¬¡æ„å»º -90%+ï¼‰ã€‚

---

## âš¡ï¸ æ ¸å¿ƒä»·å€¼

**ç¼“å­˜æ˜¯æ„å»ºä¼˜åŒ–ä¸­æ•ˆæœæœ€å¥½ã€æˆæœ¬æœ€ä½çš„æ‰‹æ®µï¼**

```
æŠ•å…¥ï¼š5 åˆ†é’Ÿé…ç½®
äº§å‡ºï¼š90%+ æ€§èƒ½æå‡ âš¡ï¸âš¡ï¸âš¡ï¸
ROIï¼šæé«˜ï¼
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

---

## ğŸ“Š å¯¹æ¯”å®éªŒ

### å®éªŒ 1ï¼šæ— ç¼“å­˜ vs æœ‰ç¼“å­˜

#### Step 1: æµ‹è¯•æ— ç¼“å­˜æ„å»º

```bash
time npm run build:no-cache
```

**è®°å½•æ—¶é—´**ï¼š___ ç§’

---

#### Step 2: æµ‹è¯•æœ‰ç¼“å­˜ï¼ˆé¦–æ¬¡æ„å»ºï¼‰

```bash
time npm run build:with-cache:first
```

**è®°å½•æ—¶é—´**ï¼š___ ç§’

**é¢„æœŸ**ï¼šå’Œæ— ç¼“å­˜å·®ä¸å¤šï¼ˆéœ€è¦å»ºç«‹ç¼“å­˜ï¼‰

---

#### Step 3: æµ‹è¯•æœ‰ç¼“å­˜ï¼ˆäºŒæ¬¡æ„å»ºï¼‰â­ï¸

```bash
time npm run build:with-cache:second
```

**è®°å½•æ—¶é—´**ï¼š___ ç§’

**é¢„æœŸ**ï¼šå¿« **90%+** âš¡ï¸âš¡ï¸âš¡ï¸

---

### å®éªŒ 2ï¼šä¿®æ”¹æ–‡ä»¶åçš„å¢é‡æ„å»º

#### Step 1: ä¿®æ”¹æºä»£ç 

```bash
# ä¿®æ”¹ src/App.js ä¸­çš„ä»»æ„å†…å®¹
# ä¾‹å¦‚ï¼šä¿®æ”¹ä¸€ä¸ªæ–‡å­—
```

#### Step 2: å†æ¬¡æ„å»º

```bash
time npm run build:with-cache
```

**è®°å½•æ—¶é—´**ï¼š___ ç§’

**é¢„æœŸ**ï¼šä»ç„¶å¾ˆå¿«ï¼ˆå¢é‡æ›´æ–°ï¼‰âš¡ï¸

---

## ğŸ“ˆ æ•°æ®è®°å½•è¡¨

| åœºæ™¯ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æå‡ |
|------|--------|--------|------|
| é¦–æ¬¡æ„å»º | ___s | ___s | ___% |
| äºŒæ¬¡æ„å»ºï¼ˆæ— å˜åŒ–ï¼‰ | ___s | ___s | ___% |
| ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ | ___s | ___s | ___% |

---

## ğŸ” æ·±å…¥ç†è§£

### 1. ç¼“å­˜å­˜åœ¨å“ªé‡Œï¼Ÿ

```bash
# æŸ¥çœ‹ Webpack ç¼“å­˜
ls -lh node_modules/.cache/webpack/

# æŸ¥çœ‹ babel-loader ç¼“å­˜
ls -lh node_modules/.cache/babel-loader/
```

---

### 2. ç¼“å­˜çš„å·¥ä½œåŸç†

```
é¦–æ¬¡æ„å»ºï¼š
  æºç  â†’ Loader è½¬æ¢ â†’ ç”Ÿæˆç¼“å­˜ â†’ è¾“å‡º
  
äºŒæ¬¡æ„å»ºï¼š
  æºç  â†’ æ£€æŸ¥ç¼“å­˜ â†’ å‘½ä¸­ âœ… â†’ ç›´æ¥ä½¿ç”¨
         â†“ (è·³è¿‡ Loader è½¬æ¢)
  èŠ‚çœ 90%+ æ—¶é—´ âš¡ï¸
```

---

### 3. ç¼“å­˜ä½•æ—¶å¤±æ•ˆï¼Ÿ

```
è‡ªåŠ¨å¤±æ•ˆï¼š
  â”œâ”€ æ–‡ä»¶å†…å®¹å˜åŒ–
  â”œâ”€ é…ç½®æ–‡ä»¶å˜åŒ–
  â”œâ”€ ä¾èµ–å˜åŒ–
  â””â”€ Webpack ç‰ˆæœ¬å‡çº§

æ‰‹åŠ¨æ¸…é™¤ï¼š
  â””â”€ npm run clean
```

---

## ğŸ”§ é…ç½®å¯¹æ¯”

### æ— ç¼“å­˜é…ç½®

```javascript
// webpack.no-cache.config.js
module.exports = {
  cache: false,  // âŒ ç¦ç”¨ç¼“å­˜
  
  module: {
    rules: [
      {
        test: /\.js$/,
        use: {
          loader: 'babel-loader',
          options: {
            cacheDirectory: false  // âŒ babel ä¹Ÿä¸ç¼“å­˜
          }
        }
      }
    ]
  }
};
```

---

### æœ‰ç¼“å­˜é…ç½® â­ï¸

```javascript
// webpack.with-cache.config.js
module.exports = {
  // â­ï¸ Webpack 5 filesystem cache
  cache: {
    type: 'filesystem',
    buildDependencies: {
      config: [__filename]
    }
  },
  
  module: {
    rules: [
      {
        test: /\.js$/,
        use: {
          loader: 'babel-loader',
          options: {
            // â­ï¸ babel-loader ç¼“å­˜
            cacheDirectory: true,
            cacheCompression: false
          }
        }
      }
    ]
  }
};
```

---

## ğŸ’¡ å…³é”®çŸ¥è¯†ç‚¹

### 1. ä¸¤ç§ç¼“å­˜çš„ä½œç”¨

| ç¼“å­˜ç±»å‹ | ä½œç”¨èŒƒå›´ | ç¼“å­˜ä½ç½® | æ•ˆæœ |
|---------|---------|---------|------|
| **filesystem cache** | æ•´ä¸ªæ¨¡å—ç¼–è¯‘ç»“æœ | `node_modules/.cache/webpack/` | â­ï¸â­ï¸â­ï¸ |
| **babel-loader cache** | Babel è½¬æ¢ç»“æœ | `node_modules/.cache/babel-loader/` | â­ï¸â­ï¸ |

**æœ€ä½³å®è·µ**ï¼šä¸¤è€…éƒ½ç”¨ï¼Œæ•ˆæœå åŠ ï¼

---

### 2. ç¼“å­˜ key çš„ç”Ÿæˆ

```javascript
cacheKey = hash(
  æ–‡ä»¶å†…å®¹ +
  loader é…ç½® +
  plugin é…ç½® +
  ä¾èµ–å…³ç³» +
  Webpack ç‰ˆæœ¬
)
```

**ä»»ä½•ä¸€é¡¹å˜åŒ–ï¼Œç¼“å­˜éƒ½ä¼šå¤±æ•ˆã€‚**

---

### 3. ä¸ºä»€ä¹ˆé¦–æ¬¡æ„å»ºæ—¶é—´ä¸å˜ï¼Ÿ

```
é¦–æ¬¡æ„å»ºï¼š
  â””â”€ éœ€è¦æ‰§è¡Œå®Œæ•´çš„æ„å»ºæµç¨‹
  â””â”€ åŒæ—¶å»ºç«‹ç¼“å­˜æ–‡ä»¶
  â””â”€ æ—¶é—´ â‰ˆ æ— ç¼“å­˜æ„å»º

äºŒæ¬¡æ„å»ºï¼š
  â””â”€ ç›´æ¥è¯»å–ç¼“å­˜
  â””â”€ è·³è¿‡ Loader è½¬æ¢
  â””â”€ æ—¶é—´ â‰ˆ 10% æ— ç¼“å­˜æ„å»º âš¡ï¸
```

---

## ğŸ¯ å®æˆ˜æŠ€å·§

### æŠ€å·§ 1ï¼šæ¸…é™¤ç¼“å­˜

```bash
# å®Œå…¨æ¸…é™¤
npm run clean

# åªæ¸…é™¤ Webpack ç¼“å­˜
rm -rf node_modules/.cache/webpack

# åªæ¸…é™¤ babel-loader ç¼“å­˜
rm -rf node_modules/.cache/babel-loader
```

---

### æŠ€å·§ 2ï¼šéªŒè¯ç¼“å­˜æ˜¯å¦ç”Ÿæ•ˆ

```bash
# 1. æŸ¥çœ‹ç¼“å­˜ç›®å½•
ls -lh node_modules/.cache/webpack/

# 2. å¯ç”¨è°ƒè¯•æ—¥å¿—
# webpack.config.js
module.exports = {
  infrastructureLogging: {
    level: 'verbose',
    debug: /webpack\.cache/
  }
};

# 3. å¯¹æ¯”æ„å»ºæ—¶é—´
time npm run build  # é¦–æ¬¡
time npm run build  # äºŒæ¬¡ï¼ˆåº”è¯¥å¿«å¾ˆå¤šï¼‰
```

---

### æŠ€å·§ 3ï¼šCI/CD ä¸­ä½¿ç”¨ç¼“å­˜

```yaml
# .github/workflows/ci.yml
- uses: actions/cache@v3
  with:
    path: node_modules/.cache/webpack
    key: ${{ hashFiles('package-lock.json') }}
```

---

## ğŸ“Š æ€§èƒ½æå‡æ¡ˆä¾‹

### å°å‹é¡¹ç›®ï¼ˆ~500 æ¨¡å—ï¼‰

```
é¦–æ¬¡ï¼š5s
äºŒæ¬¡ï¼š0.5sï¼ˆ-90%ï¼‰
```

### ä¸­å‹é¡¹ç›®ï¼ˆ~1500 æ¨¡å—ï¼‰

```
é¦–æ¬¡ï¼š30s
äºŒæ¬¡ï¼š3sï¼ˆ-90%ï¼‰
```

### å¤§å‹é¡¹ç›®ï¼ˆ~3000 æ¨¡å—ï¼‰

```
é¦–æ¬¡ï¼š180s
äºŒæ¬¡ï¼š15sï¼ˆ-92%ï¼‰
```

**ç»“è®º**ï¼šé¡¹ç›®è¶Šå¤§ï¼Œç¼“å­˜æ•ˆæœè¶Šæ˜æ˜¾ï¼

---

## ğŸ“ é¢è¯•æ”»é˜²

### é—®é¢˜ 1ï¼šWebpack 5 çš„ filesystem cache åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
```
1. åºåˆ—åŒ–
   â””â”€ å°†ç¼–è¯‘ç»“æœåºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶

2. å­˜å‚¨
   â””â”€ ä¿å­˜åˆ° node_modules/.cache/webpack/

3. ç¼“å­˜ key
   â””â”€ åŸºäºæ–‡ä»¶å†…å®¹ã€é…ç½®ã€ä¾èµ–ç”Ÿæˆ

4. å¤±æ•ˆæ¡ä»¶
   â””â”€ æ–‡ä»¶å˜åŒ–ã€é…ç½®å˜åŒ–ã€ä¾èµ–å˜åŒ–

æ•ˆæœï¼šäºŒæ¬¡æ„å»º -90%+ âš¡ï¸
```

---

### é—®é¢˜ 2ï¼šbabel-loader çš„ cacheDirectory å’Œ Webpack cache æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å¯¹æ¯”å›ç­”**ï¼š

| ç‰¹æ€§ | babel-loader cache | Webpack cache |
|------|-------------------|---------------|
| ç¼“å­˜èŒƒå›´ | åªç¼“å­˜ Babel è½¬æ¢ | ç¼“å­˜æ•´ä¸ªæ¨¡å— |
| ç¼“å­˜æ ¼å¼ | JSON | äºŒè¿›åˆ¶ |
| æ•ˆæœ | â­ï¸â­ï¸ | â­ï¸â­ï¸â­ï¸ |

**æœ€ä½³å®è·µ**ï¼šä¸¤è€…éƒ½ç”¨ï¼

---

## ğŸš€ ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»ä½“éªŒäº†**ç¼“å­˜ä¼˜åŒ–çš„å¨åŠ›**ï¼š
- âœ… ç†è§£ç¼“å­˜åŸç†
- âœ… é…ç½® filesystem cache
- âœ… é…ç½® babel-loader cache
- âœ… äºŒæ¬¡æ„å»º -90%+ âš¡ï¸âš¡ï¸âš¡ï¸

**ä¸‹ä¸€ä¸ª Demo**ï¼šå¹¶è¡Œæ„å»ºä¼˜åŒ– - `../03-parallel-build/`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [02-cache-strategies.md](../../docs/02-cache-strategies.md) - ç¼“å­˜ç­–ç•¥è¯¦ç»†æ–‡æ¡£

