# Demo 3: Source Map å®æˆ˜

## ğŸ“ ç®€ä»‹

æœ¬ Demo æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Source Map è°ƒè¯•è½¬æ¢åçš„ä»£ç ï¼Œå¯¹æ¯”ä¸åŒ devtool é€‰é¡¹çš„æ•ˆæœã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
npm install
```

### 2. å¼€å‘æ¨¡å¼
```bash
npm run dev
```

### 3. æ„å»ºæ‰€æœ‰ Source Map ç±»å‹
```bash
npm run build:all
```

ç”Ÿæˆæ–‡ä»¶ï¼š
- `dist/false/` - æ—  Source Map
- `dist/eval/` - eval
- `dist/source-map/` - source-map
- `dist/eval-source-map/` - eval-source-map
- `dist/cheap-module-source-map/` - cheap-module-source-map

## ğŸ” Chrome DevTools è°ƒè¯•å®æˆ˜

### æ­¥éª¤ 1ï¼šæ‰“å¼€ DevTools å¹¶å®šä½æºç 

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

**åœ¨æµè§ˆå™¨ä¸­**ï¼š
1. æŒ‰ `F12` æ‰“å¼€ DevTools
2. åˆ‡æ¢åˆ° **Sources** é¢æ¿
3. æŸ¥çœ‹å·¦ä¾§æ–‡ä»¶æ ‘ï¼Œä½ ä¼šçœ‹åˆ°ä¸‰ç§ç±»å‹ï¼š

```
Sources
â”œâ”€ ğŸ“ Page (localhost:xxxx)
â”‚  â””â”€ main.js                    â† âŒ å®é™…åŠ è½½çš„å‹ç¼©ä»£ç ï¼ˆä¸è¦çœ‹ï¼‰
â”‚
â”œâ”€ ğŸ“ webpack://                 â† âœ… ä½ çš„æºç ï¼ˆä¸»è¦è°ƒè¯•è¿™é‡Œï¼‰
â”‚  â””â”€ .
â”‚     â””â”€ src/
â”‚        â”œâ”€ index.js            â† âœ… æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼
â”‚        â”œâ”€ utils.js
â”‚        â””â”€ api.js
â”‚
â””â”€ ğŸ“ webpack-internal://        â† ğŸ”§ Webpack å†…éƒ¨ä»£ç 
   â””â”€ ./src/index.js
```

**å¿«é€Ÿå®šä½æºç **ï¼š
- æŒ‰ `Ctrl+P` (Mac: `Cmd+P`)
- è¾“å…¥ `index.js`
- é€‰æ‹© `webpack://./src/index.js` â­ï¸

---

### æ­¥éª¤ 2ï¼šè®¾ç½®æ–­ç‚¹

åœ¨ `webpack://./src/index.js` ä¸­ï¼š
1. æ‰¾åˆ° `testError()` å‡½æ•°ï¼ˆçº¦ç¬¬ 30 è¡Œï¼‰
2. ç‚¹å‡»è¡Œå·è®¾ç½®æ–­ç‚¹
3. é¡µé¢ä¸Šç‚¹å‡» "è§¦å‘é”™è¯¯" æŒ‰é’®
4. ä»£ç ä¼šåœ¨æ–­ç‚¹å¤„æš‚åœ

---

### æ­¥éª¤ 3ï¼šæŸ¥çœ‹è°ƒç”¨æ ˆå’Œå˜é‡

**å³ä¾§é¢æ¿**ï¼š
- **Call Stack**ï¼šæŸ¥çœ‹å‡½æ•°è°ƒç”¨é“¾
  ```
  testError          (index.js:30)
  onclick            (index.js:50)
  ```
- **Scope**ï¼šæŸ¥çœ‹å½“å‰ä½œç”¨åŸŸçš„æ‰€æœ‰å˜é‡
- **Watch**ï¼šæ·»åŠ ç›‘è§†è¡¨è¾¾å¼ï¼ˆå¦‚ `Date.now()`ï¼‰

---

### æ­¥éª¤ 4ï¼šå¯¹æ¯”æœ‰æ—  Source Map çš„å·®å¼‚

#### âœ… æœ‰ Source Mapï¼ˆå½“å‰å¼€å‘æ¨¡å¼ï¼‰

**é”™è¯¯å †æ ˆ**ï¼š
```
Error: Something went wrong!
  at testError (utils.js:10)        â† æºç ä½ç½®ï¼Œå¯è¯»ï¼
  at onclick (index.js:30)
```

**Sources é¢æ¿**ï¼š
- âœ… å¯ä»¥çœ‹åˆ° `webpack://./src/` ç›®å½•
- âœ… æºç æ¸…æ™°å¯è¯»
- âœ… å¯ä»¥è®¾ç½®æ–­ç‚¹

#### âŒ æ—  Source Mapï¼ˆæ„å»º `dist/false/`ï¼‰

**é”™è¯¯å †æ ˆ**ï¼š
```
Error: Something went wrong!
  at t (main.js:1:2345)             â† å‹ç¼©åä½ç½®ï¼Œæ— æ³•ç†è§£ï¼
  at r (main.js:1:6789)
```

**Sources é¢æ¿**ï¼š
- âŒ åªèƒ½çœ‹åˆ° `localhost` ä¸‹çš„å‹ç¼©ä»£ç 
- âŒ å˜é‡åè¢«æ··æ·†ï¼ˆa, b, cï¼‰
- âŒ æ— æ³•æœ‰æ•ˆè°ƒè¯•

**éªŒè¯æ–¹æ³•**ï¼š
```bash
# 1. æ„å»ºæ—  Source Map ç‰ˆæœ¬
npm run build:false

# 2. å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨
cd dist/false
npx http-server -p 8081

# 3. æ‰“å¼€ http://localhost:8081
# 4. æŒ‰ F12ï¼Œç‚¹å‡» "è§¦å‘é”™è¯¯"ï¼Œè§‚å¯Ÿå·®å¼‚
```

---

### æ­¥éª¤ 5ï¼šä½¿ç”¨é«˜çº§è°ƒè¯•æŠ€å·§

#### æ¡ä»¶æ–­ç‚¹

```
å³é”®ç‚¹å‡»è¡Œå· â†’ Add conditional breakpoint
è¾“å…¥æ¡ä»¶ï¼šuserId > 100

åªæœ‰å½“æ¡ä»¶ä¸º true æ—¶æ‰ä¼šæš‚åœ
```

#### Logpointï¼ˆæ— ä¾µå…¥å¼æ—¥å¿—ï¼‰

```
å³é”®ç‚¹å‡»è¡Œå· â†’ Add logpoint
è¾“å…¥ï¼š'Current user:', userData

ä¸ä¿®æ”¹æºç ï¼Œç›´æ¥åœ¨æ–­ç‚¹å¤„è¾“å‡ºæ—¥å¿—
```

#### é»‘ç›’è„šæœ¬ï¼ˆè·³è¿‡ç¬¬ä¸‰æ–¹åº“ï¼‰

```
å³é”® webpack://./node_modules/ â†’ Blackbox script

è°ƒè¯•æ—¶è‡ªåŠ¨è·³è¿‡ node_modulesï¼Œä¸ä¼šè¿›å…¥ç¬¬ä¸‰æ–¹åº“ä»£ç 
```

---

## ğŸ§ª æµ‹è¯•ä¸åŒ devtool é€‰é¡¹

### æ„å»ºæ‰€æœ‰ç±»å‹

```bash
npm run build:all
```

ç”Ÿæˆç›®å½•ï¼š
```
dist/
â”œâ”€ false/                         # devtool: false
â”‚  â””â”€ main.js (æ—  Source Map)
â”‚
â”œâ”€ eval/                          # devtool: 'eval'
â”‚  â””â”€ main.js (ä½¿ç”¨ eval)
â”‚
â”œâ”€ source-map/                    # devtool: 'source-map'
â”‚  â”œâ”€ main.js
â”‚  â””â”€ main.js.map â­ï¸
â”‚
â”œâ”€ eval-source-map/               # devtool: 'eval-source-map'
â”‚  â””â”€ main.js (å†…è” Source Map)
â”‚
â””â”€ cheap-module-source-map/       # devtool: 'cheap-module-source-map'
   â”œâ”€ main.js
   â””â”€ main.js.map
```

### é€ä¸€æµ‹è¯•

```bash
# æµ‹è¯•æ—  Source Map
cd dist/false && npx http-server -p 8081

# æµ‹è¯• source-map
cd dist/source-map && npx http-server -p 8082

# æµ‹è¯• eval-source-map
cd dist/eval-source-map && npx http-server -p 8083
```

æ¯ä¸ªç‰ˆæœ¬éƒ½æ‰“å¼€ DevTools â†’ Sources é¢æ¿ï¼Œå¯¹æ¯”ï¼š
- âœ… æ˜¯å¦èƒ½çœ‹åˆ° `webpack://` èŠ‚ç‚¹ï¼Ÿ
- âœ… æºç æ˜¯å¦æ¸…æ™°å¯è¯»ï¼Ÿ
- âœ… è¡Œå·æ˜¯å¦å‡†ç¡®ï¼Ÿ
- âœ… é”™è¯¯å †æ ˆæ˜¯å¦å‹å¥½ï¼Ÿ

---

## ğŸ“Š å®éªŒç»“æœå¯¹æ¯”

| devtool | æ„å»ºé€Ÿåº¦ | é‡æ„å»ºé€Ÿåº¦ | æºç å¯è§æ€§ | è¡Œå·å‡†ç¡®æ€§ | è°ƒè¯•ä½“éªŒ |
|---------|---------|-----------|----------|----------|---------|
| `false` | ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ | ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ | âŒ æ—  | âŒ æ—  | ğŸ’€ |
| `eval` | ğŸš€ğŸš€ğŸš€ğŸš€ | ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ | âš ï¸ æ¨¡å—çº§ | âœ… è¡Œå· | ğŸ˜ |
| `cheap-module-source-map` | ğŸš€ğŸš€ğŸš€ | ğŸš€ğŸš€ğŸš€ | âœ… å®Œæ•´ | âœ… è¡Œå· | ğŸ˜Š |
| `eval-cheap-module-source-map` | ğŸš€ğŸš€ğŸš€ğŸš€ | ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ | âœ… å®Œæ•´ | âœ… è¡Œå· | ğŸ˜Š â­ï¸ |
| `source-map` | ğŸš€ | ğŸš€ğŸš€ | âœ… å®Œæ•´ | âœ… è¡Œåˆ— | ğŸ˜ |
| `eval-source-map` | ğŸš€ğŸš€ | ğŸš€ğŸš€ğŸš€ | âœ… å®Œæ•´ | âœ… è¡Œåˆ— | ğŸ˜ |

---

## ğŸ’¡ æ¨èé…ç½®

### å¼€å‘ç¯å¢ƒ â­ï¸

```javascript
devtool: 'eval-cheap-module-source-map'
```

**ç†ç”±**ï¼š
- âœ… é‡æ„å»ºæœ€å¿«ï¼ˆé€‚åˆ HMRï¼‰
- âœ… èƒ½çœ‹åˆ°å®Œæ•´æºç 
- âœ… è¡Œå·å‡†ç¡®ï¼ˆåˆ—å·ä¸å‡†ç¡®ï¼Œä½†å½±å“ä¸å¤§ï¼‰
- âœ… æ˜ å°„è´¨é‡ä¼˜ç§€

### ç”Ÿäº§ç¯å¢ƒ â­ï¸

```javascript
devtool: 'hidden-source-map'
```

**ç†ç”±**ï¼š
- âœ… ç”Ÿæˆ Source Map æ–‡ä»¶
- âœ… ä½†ä¸åœ¨ `main.js` ä¸­å¼•ç”¨ï¼ˆç”¨æˆ·æ— æ³•è®¿é—®ï¼‰
- âœ… å¯ä»¥ä¸Šä¼ åˆ°ç›‘æ§å¹³å°ï¼ˆSentry/Bugsnagï¼‰
- âœ… ä¿æŠ¤æºç å®‰å…¨

---

## ğŸ”§ Source Map è¯Šæ–­

### æ£€æŸ¥ Source Map æ˜¯å¦åŠ è½½æˆåŠŸ

**æ–¹æ³• 1ï¼šæŸ¥çœ‹ Network é¢æ¿**
```
DevTools â†’ Network â†’ ç­›é€‰ ".map"
æŸ¥çœ‹ main.js.map æ˜¯å¦åŠ è½½ï¼ˆçŠ¶æ€ç  200ï¼‰
```

**æ–¹æ³• 2ï¼šæŸ¥çœ‹ Console è­¦å‘Š**
```
å¦‚æœ Source Map åŠ è½½å¤±è´¥ï¼ŒConsole ä¼šæ˜¾ç¤ºï¼š
âš ï¸ DevTools failed to load SourceMap
```

**æ–¹æ³• 3ï¼šæ£€æŸ¥æ–‡ä»¶æœ«å°¾**
```bash
# æŸ¥çœ‹æ‰“åŒ…åçš„æ–‡ä»¶æœ«å°¾
tail -n 1 dist/source-map/main.js

# åº”è¯¥çœ‹åˆ°ï¼š
//# sourceMappingURL=main.js.map
```

---

## ğŸ¯ è°ƒè¯•æ£€æŸ¥æ¸…å•

**å¼€å§‹è°ƒè¯•å‰**ï¼š
- âœ… `devtool` è®¾ç½®ä¸º `eval-cheap-module-source-map`
- âœ… DevTools â†’ Sources èƒ½çœ‹åˆ° `webpack://` èŠ‚ç‚¹
- âœ… èƒ½åœ¨ `webpack://./src/` ä¸‹æ‰¾åˆ°ä½ çš„æºæ–‡ä»¶
- âœ… Console é”™è¯¯å †æ ˆæ˜¾ç¤ºæºç æ–‡ä»¶åï¼ˆå¦‚ `index.js:23`ï¼‰

**è°ƒè¯•æ—¶**ï¼š
- âœ… åœ¨ `webpack://` ä¸‹çš„æºç ä¸­è®¾ç½®æ–­ç‚¹ï¼ˆä¸æ˜¯ `localhost` ä¸‹ï¼‰
- âœ… ä½¿ç”¨ `Ctrl+P` å¿«é€Ÿæœç´¢æ–‡ä»¶
- âœ… å³é”® `node_modules` â†’ Blackbox è·³è¿‡ç¬¬ä¸‰æ–¹ä»£ç 
- âœ… ä½¿ç”¨æ¡ä»¶æ–­ç‚¹å’Œ Logpoint æé«˜æ•ˆç‡

**ç”Ÿäº§ç¯å¢ƒé”™è¯¯æ’æŸ¥**ï¼š
- âœ… ä½¿ç”¨ `hidden-source-map`
- âœ… ä¸è¦å°† `.map` æ–‡ä»¶éƒ¨ç½²åˆ°å…¬ç½‘
- âœ… ä¸Šä¼ åˆ°é”™è¯¯ç›‘æ§å¹³å°
- âœ… åœ¨å¹³å°æŸ¥çœ‹è¿˜åŸåçš„å †æ ˆ

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

è¯¦ç»†çš„ Source Map åŸç†å’Œè°ƒè¯•æŠ€å·§ï¼Œè¯·æŸ¥çœ‹ï¼š
- [../docs/03-source-map.md](../docs/03-source-map.md) - å®Œæ•´çš„ Source Map æŒ‡å—
- Chrome DevTools å®æˆ˜è°ƒè¯•éƒ¨åˆ†ï¼ˆæ–‡æ¡£ç¬¬ 7 ç« ï¼‰

